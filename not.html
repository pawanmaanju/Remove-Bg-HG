<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PicsArt AI Image Enhancer</title>
    <style>
      :root {
        --primary: #ff5f5f;
        --secondary: #2d3748;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
      }
      .upload-container {
        border: 2px dashed var(--primary);
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        background: white;
        margin: 20px 0;
        transition: all 0.3s;
      }
      .upload-container:hover {
        background: #fff5f5;
      }
      #preview-container {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 30px 0;
      }
      .preview-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      #enhancedImg {
        border: 2px solid var(--primary);
      }
      button {
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
        transition: all 0.3s;
      }
      button:hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }
      button:disabled {
        background: #cbd5e0;
        cursor: not-allowed;
      }
      .loading {
        display: none;
        color: var(--primary);
        font-weight: bold;
        margin: 20px 0;
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid var(--primary);
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <h1 style="color: var(--primary)">PicsArt AI Enhancer</h1>
    <p>Enhance your photos using PicsArt's AI technology</p>

    <div class="upload-container" id="uploadBox">
      <svg
        width="48"
        height="48"
        viewBox="0 0 24 24"
        fill="none"
        stroke="var(--primary)"
        stroke-width="2"
      >
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <h3>Drag & drop image here</h3>
      <p>or</p>
      <button id="selectBtn">Select Image</button>
      <input
        type="file"
        id="fileInput"
        accept="image/*"
        style="display: none"
      />
    </div>

    <div id="preview-container">
      <div class="preview-box">
        <h3>Original</h3>
        <img id="originalImg" style="max-width: 100%; border-radius: 4px" />
      </div>
      <div class="preview-box">
        <h3>Enhanced</h3>
        <img id="enhancedImg" style="max-width: 100%; border-radius: 4px" />
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Enhancing your image with PicsArt AI...</p>
    </div>

    <div style="text-align: center">
      <button id="enhanceBtn" disabled>Enhance Image</button>
      <button id="downloadBtn" disabled>Download Enhanced</button>
    </div>

    <script>
      // Configuration
      const PICSART_API_KEY =
        "eyJraWQiOiI5NzIxYmUzNi1iMjcwLTQ5ZDUtOTc1Ni05ZDU5N2M4NmIwNTEiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhdXRoLXNlcnZpY2UtZGJjNjAwNGQtMDcyYi00MTBlLWJhNTUtN2JkODY3Y2Y1OGYyIiwiYXVkIjoiNDgzMTI4MzEyMDE5MTAxIiwibmJmIjoxNzQ1NDMyMzQ1LCJzY29wZSI6WyJiMmItYXBpLmdlbl9haSIsImIyYi1hcGkuaW1hZ2VfYXBpIl0sImlzcyI6Imh0dHBzOi8vYXBpLnBpY3NhcnQuY29tL3Rva2VuLXNlcnZpY2UiLCJvd25lcklkIjoiNDgzMTI4MzEyMDE5MTAxIiwiaWF0IjoxNzQ1NDMyMzQ1LCJqdGkiOiI0M2M5OWQ5Yy03ZWUwLTRkMmEtYjkxOS04MmJmMTU3YTcyYzEifQ.N3ACj-ItJRqB1bHM4p18oKC9HdQaXZ0vtJl6CcsYo-CKBppnV3r3b44WIdbd3cp2zN-Uous8TQZYnHv6xzC44lDeX7iUM9j3O1kax7UgT9Ls-UBMZ-7j8SieV5TxdSLUxmxkAXP6-StXM2JY4uroqjWyeqR1UwCZzqqnnsJ4iG2_AO15cJz2Zn5OBUes82wIaQ2sA9QDIsE2gDjbZ9hTilAUZSXVD2jUumaJGISAzZYD920NLzApflIgy9ZKSDBbvOjDWJDuuAyBkxKRLg3i3ZNjJqeASkrMEDuxpL7UY3diuIRDHTyxs7cedObHbnvn0JUGseWWQkkU30xcuTNaWw"; // Replace with your key
      const API_ENDPOINT = "https://api.picsart.io/tools/photo/enhance";

      // DOM Elements
      const fileInput = document.getElementById("fileInput");
      const selectBtn = document.getElementById("selectBtn");
      const enhanceBtn = document.getElementById("enhanceBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const loading = document.getElementById("loading");
      const originalImg = document.getElementById("originalImg");
      const enhancedImg = document.getElementById("enhancedImg");
      const previewContainer = document.getElementById("preview-container");
      const uploadBox = document.getElementById("uploadBox");

      let processedImageUrl = null;

      // Event Listeners
      selectBtn.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", handleImageUpload);
      enhanceBtn.addEventListener("click", enhanceWithPicsArt);
      downloadBtn.addEventListener("click", downloadImage);

      // Drag and Drop
      uploadBox.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadBox.style.backgroundColor = "#FFF0F0";
      });

      uploadBox.addEventListener("dragleave", () => {
        uploadBox.style.backgroundColor = "white";
      });

      uploadBox.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadBox.style.backgroundColor = "white";
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleImageUpload({ target: fileInput });
        }
      });

      // Core Functions
      function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.match("image.*")) {
          alert("Please select an image file (JPEG, PNG)");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          originalImg.src = e.target.result;
          enhancedImg.src = "";
          previewContainer.style.display = "grid";
          enhanceBtn.disabled = false;
          downloadBtn.disabled = true;
        };
        reader.readAsDataURL(file);
      }

      async function enhanceWithPicsArt() {
        if (!originalImg.src) return;

        loading.style.display = "block";
        enhanceBtn.disabled = true;

        try {
          // Convert image to Blob
          const blob = await fetch(originalImg.src).then((r) => r.blob());

          // Prepare form data
          const formData = new FormData();
          formData.append("image", blob, "image.jpg");
          formData.append("enhance_type", "auto"); // Can be 'auto', 'portrait', 'landscape'

          // Call PicsArt API
          const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: {
              "api-key": PICSART_API_KEY,
            },
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }

          const result = await response.json();

          if (!result.data.url) {
            throw new Error("No enhanced image URL received");
          }

          // Display enhanced image
          enhancedImg.src = result.data.url;
          processedImageUrl = result.data.url;
          downloadBtn.disabled = false;
        } catch (error) {
          console.error("Enhancement failed:", error);
          alert(`Error: ${error.message}\n\nUsing client-side fallback...`);
          await enhanceClientSide();
        } finally {
          loading.style.display = "none";
        }
      }

      // Fallback client-side enhancement
      async function enhanceClientSide() {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = originalImg.naturalWidth;
        canvas.height = originalImg.naturalHeight;
        ctx.drawImage(originalImg, 0, 0);

        // Apply basic enhancements
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
          // Increase contrast
          data[i] = 128 + (data[i] - 128) * 1.2; // R
          data[i + 1] = 128 + (data[i + 1] - 128) * 1.2; // G
          data[i + 2] = 128 + (data[i + 2] - 128) * 1.2; // B

          // Lighten shadows
          if (data[i] + data[i + 1] + data[i + 2] < 300) {
            data[i] *= 1.1;
            data[i + 1] *= 1.1;
            data[i + 2] *= 1.1;
          }
        }

        ctx.putImageData(imageData, 0, 0);
        enhancedImg.src = canvas.toDataURL("image/jpeg", 0.9);
        processedImageUrl = enhancedImg.src;
        downloadBtn.disabled = false;
      }

      function downloadImage() {
        if (!processedImageUrl) return;

        const link = document.createElement("a");
        link.href = processedImageUrl;
        link.download = "enhanced_" + (fileInput.files[0]?.name || "image.jpg");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    </script>
  </body>
</html>
